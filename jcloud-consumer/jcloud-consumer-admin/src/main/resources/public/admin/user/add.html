<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>title</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.4.1-->
    <link rel="stylesheet" href="/template/AdminLTE/2.4.10/bower_components/bootstrap/dist/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="/template/AdminLTE/2.4.10/bower_components/font-awesome/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="/template/AdminLTE/2.4.10/bower_components/Ionicons/css/ionicons.min.css">

    <!--------------------------------->
    <!-- custom plugin styles begin  -->
    <!--------------------------------->

    <link href="/template/AdminLTE/2.4.10/bower_components/PACE/themes/blue/pace-theme-flash.css" rel="stylesheet"/>
    <!-- sweetalert -->
    <link href="/js/plugins/sweetalert/sweetalert.css" rel="stylesheet"/>
    <!-- iCheck for checkboxes and radio inputs -->
    <link href="/template/AdminLTE/2.4.10/plugins/iCheck/all.css" rel="stylesheet">
    <!-- Select2 -->
    <link href="/template/AdminLTE/2.4.10/bower_components/select2/dist/css/select2.min.css" rel="stylesheet">
    <!-- switch -->
    <link href="/js/plugins/bootstrap-switch-3.3.4/dist/css/bootstrap3/bootstrap-switch.min.css" rel="stylesheet">


    <!-- jqGrid styles -->
    <!--<link href="/template/AdminLTE/2.4.10/bower_components/jquery-ui/themes/base/jquery-ui.min.css" rel="stylesheet" />-->
    <link href="/js/plugins/jqGrid/5.0.2/ui.jqgrid.min.css" rel="stylesheet"/>
    <link href="/js/plugins/jqGrid/5.0.2/ui.jqgrid.min.extend.css" rel="stylesheet"/>

    <link href="/css/jh.page.css" rel="stylesheet"/>

    <!--<script src="/js/plugins/layer/theme/default/layer.css"></script>-->

    <!--------------------------------->
    <!-- custom plugin styles end    -->
    <!--------------------------------->

    <!-- Theme style -->
    <link rel="stylesheet" href="/template/AdminLTE/2.4.10/dist/css/AdminLTE.min.css">
    <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="/template/AdminLTE/2.4.10/dist/css/skins/_all-skins.min.css">

    <!-- Google Font -->
    <link rel="stylesheet" href="/css/googleapis.css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="/js/plugins/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="/js/plugins/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- jQuery 3 -->
    <script src="/template/AdminLTE/2.4.10/bower_components/jquery/dist/jquery.min.js"></script>
    <!-- jQuery UI 1.11.4 -->
    <script src="/template/AdminLTE/2.4.10/bower_components/jquery-ui/jquery-ui.min.js"></script>
    <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
    <script>
        $.widget.bridge('uibutton', $.ui.button);
    </script>
    <!-- Bootstrap 3.4.1 -->
    <script src="/template/AdminLTE/2.4.10/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- AdminLTE App -->
    <script src="/template/AdminLTE/2.4.10/dist/js/adminlte.min.js"></script>

    <!--------------------------------->
    <!--page specific plugin scripts--->
    <!--------------------------------->
    <!--pace scripts-->
    <script src="/template/AdminLTE/2.4.10/bower_components/PACE/pace.min.js"></script>

    <!--sweetalert scripts-->
    <script src="/js/plugins/sweetalert/sweetalert.min.js"></script>

    <!-- iCheck 1.0.1 -->
    <script src="/template/AdminLTE/2.4.10/plugins/iCheck/icheck.min.js"></script>

    <!-- Select2 -->
    <script src="/template/AdminLTE/2.4.10/bower_components/select2/dist/js/select2.full.min.js"></script>

    <!-- switch -->
    <script src="/js/plugins/bootstrap-switch-3.3.4/dist/js/bootstrap-switch.min.js"></script>

    <!--jqgrid scripts-->
    <script src="/js/plugins/jqGrid/5.0.2/jquery.jqGrid.min.js"></script>
    <script src="/js/plugins/jqGrid/5.0.2/grid.locale-en.js"></script>

    <script src="/js/plugins/layer/layer.js"></script>

    <!-- form.js -->
    <script src="/js/jh.sweetalert.js"></script>
    <script src="/js/jh.jqgrid.js"></script>
    <script src="/js/jh.form.js"></script>
    <script src="/js/jh.util.js"></script>

    <link href="/js/plugins/bootstrapValidator/bootstrapValidator.min.css" rel="stylesheet"/>
    <script src="/js/plugins/bootstrapValidator/bootstrapValidator.min.js" type="text/javascript"></script>
    <script src="/js/plugins/bootstrapValidator/bootstrapValidator.zh_CN.min.js" type="text/javascript"></script>

    <!-- inline scripts related to this page -->
    <script type="text/javascript">
        //paceOptions = {
        //    ajax: false, // Monitors all ajax requests on the page
        //    document: false, // Checks for the existance of specific elements on the page
        //    eventLag: false, // Checks the document readyState
        //    elements: {
        //        selectors: ['.my-page'] // Checks for event loop lag signaling that javascript is being executed
        //    },
        //    startOnPageLoad: false
        //};
    </script>
    <style type="text/css">
        page {
            width: 100%;
            height: 100%;
            margin: 0px;
            padding: 0px;
            border: 0px;
        }

        body {
            width: 100%;
            height: 100%;
            margin: 0px;
            padding: 0px;
            background: #ffffff;
        }

        /*pace style*/
        /*body > :not(.pace), body:before, body:after {
            -webkit-transition: opacity .4s ease-in-out;
            -moz-transition: opacity .4s ease-in-out;
            -o-transition: opacity .4s ease-in-out;
            -ms-transition: opacity .4s ease-in-out;
            transition: opacity .4s ease-in-out;
        }

        body:not(.pace-done) > :not(.pace), body:not(.pace-done):before, body:not(.pace-done):after {
            opacity: 0;
        }*/

        /*jqgrid style*/

        .ui-jqgrid .ui-jqgrid-hdiv {
            line-height: 0px;
        }

        .ui-jqgrid .ui-jqgrid-htable th span.ui-jqgrid-resize {
            height: 30px !important;
        }

        .ui-jqgrid .ui-jqgrid-labels th {
            text-align: center !important;
            font-weight: 500 !important;
        }

        .ui-jqgrid-sortable {
            font-weight: 500 !important;
        }

        .ui-jqgrid .ui-jqgrid-pager {
            height: auto;
            padding-top: 5px !important;
            padding-bottom: 5px !important;
        }

        /*modal style*/
        .modal-header {
            padding: 5px 5px 5px 10px;
        }

        .modal-footer {
            padding: 5px 5px 5px 10px;
        }

        .modal-footer button {
            padding: 1px 6px;
        }
    </style>

</head>
<body class="container-fluid no-margin no-padding">
<!-- 在这里嵌入main content -->

<header class="main-header">

</header>
<div class="content-wrapper no-margin">
    <form id="formMain" class="form-horizontal">
        <div id="divContent" class="box-body" style="padding: 5px;overflow-y:auto;overflow-x: hidden;border: none;">

            <div class="box">
                <div class="box-header with-border">
                    <h3 class="box-title"><i class="fa fa-bars"></i>详细</h3>

                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse"><i
                                class="fa fa-minus"></i></button>
                        <!--<button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-remove"></i>-->
                        <!--</button>-->
                    </div>
                </div>
                <!-- /.box-header -->
                <form class="form-horizontal">
                    <div class="box-body">

                        <div class="form-group" hidden>
                            <label for="id" class="col-xs-2 control-label">主键</label>
                            <div class="col-xs-10">
                                <input type="text" class="form-control" id="id" name="id"/>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="userGroupId" class="col-xs-2 control-label">用户组</label>
                            <div class="col-xs-10">
                                <select class="form-control select2" style="width: 100%;" id="userGroupId"
                                        name="userGroupId" data-toggle="tooltip"
                                        title="可选">

                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="userCode" class="col-xs-2 control-label">用户编号</label>
                            <div class="col-xs-10">
                                <input type="text" class="form-control" id="userCode" name="userCode"
                                       data-toggle="tooltip" title="主键,必须唯一,不能为空."/>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="userName" class="col-xs-2 control-label">用户名称</label>
                            <div class="col-xs-10">
                                <input class="form-control" type="text" id="userName" name="userName"
                                       data-toggle="tooltip" title="用户名称"/>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="password" class="col-xs-2 control-label">密码</label>
                            <div class="col-xs-10">
                                <input class="form-control" type="text" id="password" name="password"
                                       data-toggle="tooltip" title="密码"/>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="nickName" class="col-xs-2 control-label">昵称</label>
                            <div class="col-xs-10">
                                <input class="form-control" type="text" id="nickName" name="nickName"
                                       data-toggle="tooltip" title="昵称"/>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="isEnable" class="col-xs-2 control-label">状态</label>
                            <div class="col-xs-10">
                                <input id="isEnable" class="switch" name="isEnable" type="checkbox"
                                       checked
                                       data-on-color="success" data-off-color="default"
                                       data-on-text="开启" data-off-text="关闭" data-label-text=""/>
                            </div>
                        </div>

                    </div>

                </form>
            </div>

            <!-- /.box -->
        </div>
    </form>
</div>
<!-- /.box -->

<!-- /.content-wrapper -->
<footer class="main-footer no-margin" style="padding:5px;">
    <div class="row no-print">
        <div class="col-xs-12">
            <button id="btnCancel" type="button" class="btn btn-primary pull-right">
                <i class="fa fa-close"></i> 取消
            </button>

            <button id="btnOk" type="button" class="btn btn-success pull-right" style="margin-right: 5px;">
                <i class="fa fa-check"></i> 保存
            </button>
        </div>
    </div>

</footer>

<script type="text/javascript">

    //page resize function ,just use for iframe size will be changed.
    function pageResize() {
        //parent.layer.iframeAuto(index);
    }

    function validationForm() {
        $("form").bootstrapValidator({
            message: "无效的值",
            feedbackIcons: {
                valid: "glyphicon glyphicon-ok",
                invalid: "glyphicon glyphicon-remove",
                validating: "glyphicon glyphicon-refresh"
            },
            //excluded: "hidden",
            excluded: ":disabled",   // <=== Adding the 'excluded' option
            fields: {

                userGroupId: {
                    validators: {}
                },
                userCode: {
                    validators: {
                        notEmpty: {
                            message: "必填项."
                        },
                        stringLength: {
                            min: 1,
                            max: 30,
                            message: "长度大于1位并且小于30位."
                        },
                        regexp: {
                            regexp: /^[a-zA-Z0-9_\-]+$/,
                            message: "只能由字母、数字、下划线、横线."
                        }
                    }
                },
                userName: {
                    validators: {
                        notEmpty: {
                            message: "必填项."
                        },
                        stringLength: {
                            min: 5,
                            max: 30,
                            message: "长度大于5位并且小于30位."
                        },
                        regexp: {
                            regexp: /^[a-zA-Z0-9_\-\u4e00-\u9fa5]+$/,
                            message: "只能由字母、数字、下划线、横线、中文."
                        }
                    }
                },
                password: {
                    validators: {
                        notEmpty: {
                            message: "必填项."
                        },
                        stringLength: {
                            min: 5,
                            max: 30,
                            message: "长度大于5位并且小于30位."
                        },
                        regexp: {
                            regexp: /^[a-zA-Z0-9_\-]+$/,
                            message: "只能由字母、数字、下划线、横线."
                        }
                    }
                },
                nickName: {
                    validators: {
                        stringLength: {
                            min: 1,
                            max: 30,
                            message: "长度大于1位并且小于30位."
                        },
                        regexp: {
                            regexp: /^[a-zA-Z0-9_\-\u4e00-\u9fa5]+$/,
                            message: "只能由字母、数字、下划线、横线、中文."
                        }
                    }
                }
            }
        });
    }

    var operationId;
    var operationType;

    //page init
    $(document).ready(function () {
        //pageResize();
        $(window).on("resize", function () {
            pageResize();
        });

        //parent.layer.iframeAuto(index);

        //Flat red color scheme for iCheck
        $('input[type="checkbox"].flat-red, input[type="radio"].flat-red').iCheck({
            checkboxClass: 'icheckbox_flat-blue',
            radioClass: 'iradio_flat-blue'
        });

        //将多选的值赋值到隐藏域
//        $('[name="authorized_grant_types[]"]').on('ifChanged', function (event) {
//
//            var str = "";
//            var ids = "";
//            $('[name="authorized_grant_types[]"]:checkbox').each(function () {
//                if (true == $(this).is(':checked')) {
//                    str += $(this).val() + ",";
//                }
//            });
//
//            if (str.substr(str.length - 1) == ',') {
//                ids = str.substr(0, str.length - 1);
//            }
//
//            $("#authorized_grant_types").val(ids);
//
//        });

        //Initialize Select2 Elements
        $('.select2').select2({
            language: "zh-CN",//汉化
        });

        $('.switch').bootstrapSwitch();

        fillSelectRemote("#userGroupId", "/admin/usergroup/find", "userGroupName", "id", true);

        //验证表单
        validationForm();

        //判断操作类型
        var operationId = getUrlParam("id");
        if (operationId) {
            operationType = "update";

            //获取数据
            getModel({
                url: "/admin/user/get/" + operationId,
                showSuccessInfo: false,
                beforeSendAction: function () {
                    disableControl("#btnOk");
                },
                completeAction: function () {
                    enableControl("#btnOk");
                },
                successCallBack: function (data) {

                    //填充表单
                    fillJsonToForm("formMain", data);

                },
                failCallBack: function (data) {

                }
            });
        }
        else {
            operationType = "add";
        }

        $("#btnOk").click(function () {

            /*手动验证表单，当是普通按钮时。*/
            $("form").data("bootstrapValidator").validate();
            if (!$("form").data("bootstrapValidator").isValid()) {
                return;
            }

            var operationUrl = "/admin/user/add";
            if (operationType == "update") {
                operationUrl = "/admin/user/update";
            }

            submitForm({
                url: operationUrl,
                formId: "formMain",
                postDataType: "json",
                showSuccessInfo: false,
                beforeSendAction: function () {
                    disableControl("#btnOk");
                },
                completeAction: function () {
                    enableControl("#btnOk");
                },
                successCallBack: function (data) {
                    alertSuccess(function () {
                        refreshParentGrid();
                        closeCurrentLayer();
                    });
                },
                failCallBack: function (data) {

                }
            });

        });

        $("#btnCancel").click(function () {

            closeCurrentLayer();
        });
    });
</script>

</body>
</html>
