<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>AdminLTE 2 | Dashboard</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.4.1-->
    <link rel="stylesheet" href="/template/AdminLTE/2.4.10/bower_components/bootstrap/dist/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="/template/AdminLTE/2.4.10/bower_components/font-awesome/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="/template/AdminLTE/2.4.10/bower_components/Ionicons/css/ionicons.min.css">

    <!--------------------------------->
    <!-- custom plugin styles begin  -->
    <!--------------------------------->

    <link href="/template/AdminLTE/2.4.10/bower_components/PACE/themes/blue/pace-theme-flash.css" rel="stylesheet"/>
    <!-- sweetalert -->
    <link href="/js/plugins/sweetalert/sweetalert.css" rel="stylesheet"/>
    <!-- iCheck for checkboxes and radio inputs -->
    <link href="/template/AdminLTE/2.4.10/plugins/iCheck/all.css" rel="stylesheet" >
    <!-- Select2 -->
    <link href="/template/AdminLTE/2.4.10/bower_components/select2/dist/css/select2.min.css" rel="stylesheet" >


    <!-- jqGrid styles -->
    <!--<link href="/template/AdminLTE/2.4.10/bower_components/jquery-ui/themes/base/jquery-ui.min.css" rel="stylesheet" />-->
    <link href="/js/plugins/jqGrid/5.0.2/ui.jqgrid.min.css" rel="stylesheet"/>
    <link href="/js/plugins/jqGrid/5.0.2/ui.jqgrid.min.extend.css" rel="stylesheet"/>


    <!--<script src="/js/plugins/layer/theme/default/layer.css"></script>-->

    <!--------------------------------->
    <!-- custom plugin styles end    -->
    <!--------------------------------->

    <!-- Theme style -->
    <link rel="stylesheet" href="/template/AdminLTE/2.4.10/dist/css/AdminLTE.min.css">
    <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="/template/AdminLTE/2.4.10/dist/css/skins/_all-skins.min.css">

    <!-- Google Font -->
    <link rel="stylesheet" href="/css/googleapis.css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="/js/plugins/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="/js/plugins/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- jQuery 3 -->
    <script src="/template/AdminLTE/2.4.10/bower_components/jquery/dist/jquery.min.js"></script>
    <!-- jQuery UI 1.11.4 -->
    <script src="/template/AdminLTE/2.4.10/bower_components/jquery-ui/jquery-ui.min.js"></script>
    <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
    <script>
        $.widget.bridge('uibutton', $.ui.button);
    </script>
    <!-- Bootstrap 3.4.1 -->
    <script src="/template/AdminLTE/2.4.10/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- AdminLTE App -->
    <script src="/template/AdminLTE/2.4.10/dist/js/adminlte.min.js"></script>

    <!--------------------------------->
    <!--page specific plugin scripts--->
    <!--------------------------------->
    <!--pace scripts-->
    <script src="/template/AdminLTE/2.4.10/bower_components/PACE/pace.min.js"></script>

    <!--sweetalert scripts-->
    <script src="/js/plugins/sweetalert/sweetalert.min.js"></script>

    <!-- iCheck 1.0.1 -->
    <script src="/template/AdminLTE/2.4.10/plugins/iCheck/icheck.min.js"></script>

    <!-- Select2 -->
    <script src="/template/AdminLTE/2.4.10/bower_components/select2/dist/js/select2.full.min.js"></script>

    <!--jqgrid scripts-->
    <script src="/js/plugins/jqGrid/5.0.2/jquery.jqGrid.min.js"></script>
    <script src="/js/plugins/jqGrid/5.0.2/grid.locale-en.js"></script>

    <script src="/js/plugins/layer/layer.js"></script>

    <!-- form.js -->
    <script src="/js/jh.form.js"></script>

    <link href="/js/plugins/bootstrapValidator/bootstrapValidator.min.css" rel="stylesheet" />
    <script src="/js/plugins/bootstrapValidator/bootstrapValidator.min.js" type="text/javascript"></script>
    <script src="/js/plugins/bootstrapValidator/bootstrapValidator.zh_CN.min.js" type="text/javascript"></script>

    <!-- inline scripts related to this page -->
    <script type="text/javascript">
        //paceOptions = {
        //    ajax: false, // Monitors all ajax requests on the page
        //    document: false, // Checks for the existance of specific elements on the page
        //    eventLag: false, // Checks the document readyState
        //    elements: {
        //        selectors: ['.my-page'] // Checks for event loop lag signaling that javascript is being executed
        //    },
        //    startOnPageLoad: false
        //};
    </script>
    <style type="text/css">
        page {
            width: 100%;
            height: 100%;
            margin: 0px;
            padding: 0px;
            border: 0px;
        }

        body {
            width: 100%;
            height: 100%;
            margin: 0px;
            padding: 0px;
            background: #ffffff;
        }

        /*pace style*/
        /*body > :not(.pace), body:before, body:after {
            -webkit-transition: opacity .4s ease-in-out;
            -moz-transition: opacity .4s ease-in-out;
            -o-transition: opacity .4s ease-in-out;
            -ms-transition: opacity .4s ease-in-out;
            transition: opacity .4s ease-in-out;
        }

        body:not(.pace-done) > :not(.pace), body:not(.pace-done):before, body:not(.pace-done):after {
            opacity: 0;
        }*/

        /*jqgrid style*/

        .ui-jqgrid .ui-jqgrid-hdiv {
            line-height: 0px;
        }

        .ui-jqgrid .ui-jqgrid-htable th span.ui-jqgrid-resize {
            height: 30px !important;
        }

        .ui-jqgrid .ui-jqgrid-labels th {
            text-align: center !important;
            font-weight: 500 !important;
        }

        .ui-jqgrid-sortable {
            font-weight: 500 !important;
        }

        .ui-jqgrid .ui-jqgrid-pager {
            height: auto;
            padding-top: 5px !important;
            padding-bottom: 5px !important;
        }

        /*modal style*/
        .modal-header {
            padding: 5px 5px 5px 10px;
        }

        .modal-footer {
            padding: 5px 5px 5px 10px;
        }

        .modal-footer button {
            padding: 1px 6px;
        }
    </style>

</head>
<body class="container-fluid no-margin no-padding">
<!-- 在这里嵌入main content -->

<header class="main-header">

</header>
<div class="content-wrapper no-margin">
    <form id="formMain" class="form-horizontal">
        <div id="divContent" class="box-body" style="padding: 5px;overflow-y:auto;overflow-x: hidden;border: none;">

            <div class="box">
                <div class="box-header with-border">
                    <h3 class="box-title"><i class="fa fa-bars"></i>详细</h3>

                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse"><i
                                class="fa fa-minus"></i></button>
                        <!--<button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-remove"></i>-->
                        <!--</button>-->
                    </div>
                </div>
                <!-- /.box-header -->
                <form class="form-horizontal">
                    <div class="box-body">
                        <div class="form-group">
                            <label for="client_id" class="col-xs-2 control-label">客户端编号</label>
                            <div class="col-xs-4">
                                <input type="text" class="form-control" id="client_id" name="client_id" data-toggle="tooltip" title="主键,必须唯一,不能为空.用于唯一标识每一个客户端"/>
                            </div>
                            <label for="resource_ids" class="col-xs-2 control-label">资源编号</label>
                            <div class="col-xs-4">
                                <input class="form-control" type="text" id="resource_ids" name="resource_ids" data-toggle="tooltip" title="客户端所能访问的资源id集合,多个资源时用逗号(,)分隔,如: 'unity-resource,mobile-resource'"/>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="client_secret" class="col-xs-2 control-label">客户端密码</label>
                            <div class="col-xs-4">
                                <input type="text" class="form-control" id="client_secret" name="client_secret" data-toggle="tooltip" title="指定客户端(client)的访问密匙"/>
                            </div>
                            <label for="scope" class="col-xs-2 control-label">作用范围</label>
                            <div class="col-xs-4">
                                <select class="form-control select2" style="width: 100%;" multiple="multiple" id="scope" name="scope" data-toggle="tooltip" title="指定客户端申请的权限范围"/>
                                    <option selected="selected">read</option>
                                    <option>write</option>
                                    <option>trust</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="authorities" class="col-xs-2 control-label">权限</label>
                            <div class="col-xs-4">
                                <input type="text" class="form-control" id="authorities" name="authorities" data-toggle="tooltip" title="指定客户端所拥有的Spring Security的权限值,可选, 若有多个权限值,用逗号(,)分隔, 如: 'ROLE_UNITY,ROLE_USER'. "/>
                            </div>
                            <label for="autoapprove" class="col-xs-2 control-label">自动批准</label>
                            <div class="col-xs-4">
                                <select class="form-control select2" style="width: 100%;" id="autoapprove" name="autoapprove"  data-toggle="tooltip" title="设置用户是否自动Approval操作, 默认值为 'false', 可选值包括 'true','false', 'read','write'.该字段只适用于grant_type='authorization_code'的情况.">
                                    <option selected="selected">false</option>
                                    <option>true</option>
                                    <option>read</option>
                                    <option>write</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="access_token_validity" class="col-xs-2 control-label">访问Token有效期</label>
                            <div class="col-xs-4">
                                <div class="input-group">
                                    <input class="form-control" type="text" id="access_token_validity" name="access_token_validity" data-toggle="tooltip" title="设定客户端的access_token的有效时间值(单位:秒),可选, 若不设定值则使用默认的有效时间值(60 * 60 * 12, 12小时). " value="43200"/>
                                    <span class="input-group-addon">
                                        <label for="access_token_validity">秒</label>
                                    </span>
                                </div>
                            </div>
                            <label for="refresh_token_validity" class="col-xs-2 control-label">刷新Token有效期</label>
                            <div class="col-xs-4">
                                <div class="input-group">
                                    <input type="text" class="form-control" id="refresh_token_validity" name="refresh_token_validity" data-toggle="tooltip" title="设定客户端的refresh_token的有效时间值(单位:秒),可选, 若不设定值则使用默认的有效时间值(60 * 60 * 24 * 30, 30天). " value="2592000"/>
                                    <span class="input-group-addon">
                                        <label for="access_token_validity">秒</label>
                                    </span>
                                </div>
                            </div>
                        </div>


                        <div class="form-group">
                            <label for="divAuthorizedGrantTypes" class="col-xs-2 control-label">认证方式</label>
                            <div class="col-xs-10" id="divAuthorizedGrantTypes">
                                <label class="col-xs-2 control-label">
                                    <input type="checkbox" class="flat-red" name="authorized_grant_types[]" value="authorization_code">
                                    授权码模式
                                </label>
                                <label class="col-xs-2 control-label">
                                    <input type="checkbox" class="flat-red" name="authorized_grant_types[]" value="implicit">
                                    简化模式
                                </label>
                                <label class="col-xs-2 control-label">
                                    <input type="checkbox" class="flat-red" name="authorized_grant_types[]" value="password">
                                    密码模式
                                </label>
                                <label class="col-xs-2 control-label">
                                    <input type="checkbox" class="flat-red" name="authorized_grant_types[]" value="client_credentials">
                                    客户端模式
                                </label>
                                <label class="col-xs-2 control-label">
                                    <input type="checkbox" class="flat-red" name="authorized_grant_types[]" value="refresh_token">
                                    更新Token
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="web_server_redirect_uri" class="col-xs-2 control-label">回调路径</label>
                            <div class="col-xs-10">
                                <input class="form-control" type="text" id="web_server_redirect_uri" name="web_server_redirect_uri" data-toggle="tooltip" title="客户端的重定向URI,可为空, 当grant_type为authorization_code或implicit时, 在Oauth的流程中会使用并检查与注册时填写的redirect_uri是否一致."/>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="additional_information" class="col-xs-2 control-label">附加信息(JSON格式)</label>
                            <div class="col-xs-10">
                                <input class="form-control" type="text" id="additional_information" name="additional_information" data-toggle="tooltip" title="这是一个预留的字段,在Oauth的流程中没有实际的使用,可选,但若设置值,必须是JSON格式的数据"/>
                            </div>
                        </div>
                    </div>

                </form>
            </div>

            <!-- /.box -->
        </div>
    </form>
</div>
<!-- /.box -->

<!-- /.content-wrapper -->
<footer class="main-footer no-margin" style="padding:5px;">
    <div class="row no-print">
        <div class="col-xs-12">
            <button id="btnCancel" type="button" class="btn btn-primary pull-right">
                <i class="fa fa-close"></i> 取消
            </button>

            <button id="btnOk" type="button" class="btn btn-success pull-right" style="margin-right: 5px;">
                <i class="fa fa-check"></i> 保存
            </button>
        </div>
    </div>

</footer>

<script type="text/javascript">

    //注意：parent 是 JS 自带的全局对象，可用于操作父页面
    var index = parent.layer.getFrameIndex(window.name); //获取窗口索引

    //page resize function ,just use for iframe size will be changed.
    function pageResize() {
        //parent.layer.iframeAuto(index);
    }

    function validationForm() {
        $("form").bootstrapValidator({
            message: "无效的值",
            feedbackIcons: {
                valid: "glyphicon glyphicon-ok",
                invalid: "glyphicon glyphicon-remove",
                validating: "glyphicon glyphicon-refresh"
            },
            //excluded: "hidden",
            excluded: ":disabled",   // <=== Adding the 'excluded' option
            fields: {

                client_id: {
                    validators: {
                        notEmpty: {
                            message: "必填项."
                        },
                        stringLength: {
                            min: 5,
                            max: 30,
                            message: "长度大于5位并且小于30位."
                        },
                        regexp: {
                            regexp: /^[a-zA-Z0-9_\-]+$/,
                            message: "只能由字母、数字、下划线、横线."
                        },
//                        remote: {
//                            url: '/oauth/oauthclientdetails/check',//验证地址,后台需要返回{"valid":true}格式
//                            message: '已存在',//提示消息
//                            delay :  2000,//每输入一个字符，就发ajax请求，服务器压力还是太大，设置2秒发送一次ajax（默认输入一个字符，提交一次，服务器压力太大）
//                            type: 'POST'//请求方式
//                        },
                    }
                },
                resource_ids: {
                    validators: {

                    }
                },
                client_secret: {
                    validators: {
                        notEmpty: {
                            message: "必填项."
                        },
                        stringLength: {
                            min: 5,
                            max: 30,
                            message: "长度大于5位并且小于30位."
                        },
                        regexp: {
                            regexp: /^[a-zA-Z0-9_\-]+$/,
                            message: "只能由字母、数字、下划线、横线."
                        }
                    }
                },
                scope: {
                    validators: {

                    }
                },
                autoapprove: {
                    validators: {

                    }
                },
                access_token_validity: {
                    validators: {
                        digits: {
                            message: "必须为数字."
                        },
                        stringLength: {
                            min: 1,
                            max: 20,
                            message: "长度不能超过20位."
                        }
                    }
                },
                refresh_token_validity: {
                    validators: {
                        digits: {
                            message: "必须为数字."
                        },
                        stringLength: {
                            min: 1,
                            max: 20,
                            message: "长度不能超过20位."
                        }
                    }
                },
                web_server_redirect_uri: {
                    validators: {
                        stringLength: {
                            min: 0,
                            max: 50,
                            message: "长度不能超过100位."
                        }
                    }
                },
                additional_information: {
                    validators: {
                        stringLength: {
                            min: 0,
                            max: 50,
                            message: "长度不能超过200位."
                        }
                    }
                }
            }
        });
    }

    var operationId;
    var operationType;

    //page init
    $(document).ready(function () {
        //pageResize();
        $(window).on("resize", function () {
            pageResize();
        });

        //parent.layer.iframeAuto(index);

        //Flat red color scheme for iCheck
        $('input[type="checkbox"].flat-red, input[type="radio"].flat-red').iCheck({
            checkboxClass: 'icheckbox_flat-blue',
            radioClass   : 'iradio_flat-blue'
        });

        //Initialize Select2 Elements
        $('.select2').select2();

        //验证表单
        validationForm();

        //判断操作类型
        var operationId = getUrlParam("id");
        if(operationId)
        {
            operationType = "update";

            //获取数据
            getModel({
                url: "/oauth/oauthclientdetails/get/" + operationId,
                showSuccessInfo: false,
                beforeSendAction: function () {
                    $("#btnOk").addClass("disabled").attr("disabled", true);
                },
                completeAction: function () {

                },
                successCallBack: function (data) {
                    $("#btnOk").removeClass("disabled").attr("disabled", false);

                    //填充表单
                    fillJsonToForm("formMain", data);
                },
                failCallBack: function (data) {

                }
            });
        }
        else {
            operationType = "add";
        }

        $("#btnOk").click(function () {

            /*手动验证表单，当是普通按钮时。*/
            $("form").data("bootstrapValidator").validate();
            if (!$("form").data("bootstrapValidator").isValid()) {
                return;
            }

            var operationUrl = "/oauth/oauthclientdetails/add";
            if(operationType == "update")
            {
                operationUrl = "/oauth/oauthclientdetails/update";
            }

            submitForm({
                url: operationUrl,
                formId: "formMain",
                showSuccessInfo: false,
                beforeSendAction: function () {
                    $("#btnOk").addClass("disabled").attr("disabled", true);
                },
                completeAction: function () {
                    $("#btnOk").removeClass("disabled").attr("disabled", false);
                },
                successCallBack: function (data) {
                    swal({
                        title: "提示",
                        text: "保存成功",
                        type: "success",
                        confirmButtonText: "确定",
                        closeOnConfirm: true
                    }, function () {

                        $("#btnCancel").trigger("click");
                    });
                },
                failCallBack: function (data) {

                }
            });

        });

        $("#btnCancel").click(function () {
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
        });
    });
</script>

</body>
</html>
